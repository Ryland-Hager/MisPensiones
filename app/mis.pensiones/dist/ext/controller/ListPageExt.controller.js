sap.ui.define(["sap/ui/core/Fragment","sap/ui/core/mvc/ControllerExtension","sap/m/Dialog","sap/m/DialogType","sap/m/Text","sap/m/Button","sap/m/ButtonType","sap/m/Label","sap/m/Input","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,o,a,n,i,s,r,l,c,p,u,d,g){"use strict";var h=d.EdmType;return t.extend("mis.pensiones.ext.controller.ListPageExt",{override:{onInit:function(){this._resourceBundle=this.base.getAppComponent().getModel("i18n").getResourceBundle();var e=new u({ID:"",primerNombre:"",apellidoPaterno:"",apellidoMaterno:"",maxAportacion:""});this.getView().setModel(e,"empleado")}},onCambioPorcentaje:function(t,o){this.getView().getModel("empleado");var a=this;this.aSelectedContexts=o;var n=this.getView().getModel("empleado");n.setProperty("/ID",o.map(function(e){return e.getObject().ID}));n.setProperty("/primerNombre",o.map(function(e){return e.getObject().primerNombre}));n.setProperty("/apellidoPaterno",o.map(function(e){return e.getObject().apellidoPaterno}));n.setProperty("/apellidoMaterno",o.map(function(e){return e.getObject().apellidoMaterno}));var i=1;var s=function(){this.base.editFlow.invokeAction("PensionesService.maxPorcentajeCheck",{contexts:this.aSelectedContexts,skipParameterDialog:true}).then(function(e){a.base.getExtensionAPI().refresh()})}.bind(this);s();n.setProperty("/maxAportacion",i);if(!this.pDialog){this.pDialog=e.load({id:"idupdatePorcentaje",name:"mis.pensiones.ext.fragments.UpdatePorcentaje",controller:this})}this.pDialog.then(function(e){e.open()})},onCargaManual:function(t){var o=this;if(!this.pDialog){this.pDialog=e.load({id:"idUploadFile",name:"mis.pensiones.ext.fragments.UploadFile",controller:this})}this.pDialog.then(function(e){e.open()})},onOkPorcentaje:function(e){this.setDialogBusy(true);var t=this;let o=this.byId("idupdatePorcentaje","idAportacion").getValue();var a=function(){this.base.editFlow.invokeAction("PensionesService.cambioPorcentaje",{contexts:this.aSelectedContexts,parameterValues:[{name:"aportacionFutura",value:o}],skipParameterDialog:true}).then(function(e){t.setDialogBusy(false);t.closeDialog();t.base.getExtensionAPI().refresh()})}.bind(this);a()},onBeforeOpen:function(e){this.oUploadDialog=e.getSource();this.base.getExtensionAPI().addDependent(this.oUploadDialog)},onBeforeOpenPorcentaje:function(e){this.oPorcentajeDialog=e.getSource();this.base.getExtensionAPI().addDependent(this.oPorcentajeDialog)},onAfterClosePorcentaje:function(e){this.base.getExtensionAPI().removeDependent(this.oPorcentajeDialog);this.oPorcentajeDialog.destroy();this.oPorcentajeDialog=null;this.pDialog=undefined},onAfterClose:function(e){this.base.getExtensionAPI().removeDependent(this.oUploadDialog);this.oUploadDialog.destroy();this.oUploadDialog=null;this.pDialog=undefined},setDialogBusy:function(e){this.oUploadDialog&&this.oUploadDialog.setBusy(e);this.oPorcentajeDialog&&this.oPorcentajeDialog.setBusy(e)},byId:function(t,o){return e.byId(t,o)},onCancel:function(e){this.closeDialog()},onCancelPorcentaje:function(e){this.closeDialog()},closeDialog:function(){this.oUploadDialog&&this.oUploadDialog.close();this.oPorcentajeDialog&&this.oPorcentajeDialog.close()},validateInput:function(e){var t=e.getBinding("aportacion")},onPorcentajeChange:function(e){this.setOkButtonEnabled(true)},setOkButtonEnabled:function(e){this.oUploadDialog&&this.oUploadDialog.getBeginButton().setEnabled(e);this.oPorcentajeDialog&&this.oPorcentajeDialog.getBeginButton().setEnabled(e)},onOk:function(e){this.setDialogBusy(true);var t=this.byId("idUploadFile","uploader");var o=new sap.ui.unified.FileUploaderParameter;o.setName("slug");o.setValue("Empleado");t.removeHeaderParameter("slug");t.addHeaderParameter(o);let a;if(window.location.href.search("port4004")>0)a=this.base.getExtensionAPI()._controller._oAppComponent.getManifestObject().resolveUri("/pensiones/cargaDeExcel/excel");else{a="pensiones/cargaDeExcel/excel"}t.setUploadUrl(a);t.checkFileReadable().then(function(){t.upload()}).catch(function(e){const t=this._resourceBundle.getText("fileNotReadable");this.showError(t);this.setDialogBusy(false)})},showError:function(e,t,o){const a=this._resourceBundle.getText("uploadFailed");p.error(a)},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");let o=this._resourceBundle.getText("fileTypeNotSupported");const a=this._resourceBundle.getText("supportedTypes");o=o+" *. "+e.getParameter("fileType")+". "+a+t;this.showError(o)},onFileAllowed:function(e){this.setOkButtonEnabled(true)},onFileEmpty:function(e){this.setOkButtonEnabled(false)},onUploadComplete:function(e){var t=e.getParameter("status");var o=e.getSource();o.clear();this.setOkButtonEnabled(false);this.setDialogBusy(false);if(t>=400){var a;try{a=JSON.parse(e.getParameter("responseRaw"))}catch(t){a=e.getParameter("responseRaw")}if(a&&a.error&&a.error.message){this.showError(a.error.code,a.error.target,a&&a.error&&a.error.message);this.closeDialog()}else{this.closeDialog()}}else{let t=JSON.parse(e.mParameters.responseRaw);if(t.length){this._downloadSpreadsheet(t,"Registros")}this.closeDialog()}},_createColumnConfig:function(e){return e.map(function(e){let t={};t.label=e.toUpperCase();t.property=e;return t})}})});