sap.ui.define(["sap/ui/core/Fragment","sap/ui/core/mvc/ControllerExtension","sap/m/Dialog","sap/m/DialogType","sap/m/Text","sap/m/Button","sap/m/ButtonType","sap/m/Label","sap/m/Input","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,o,n,a,i,s,r,l,c,p,u,d,g){"use strict";var h=d.EdmType;return t.extend("mis.pensiones.ext.controller.ListPageExt",{override:{onInit:function(){this._resourceBundle=this.base.getAppComponent().getModel("i18n").getResourceBundle()}},onCambioPorcentaje:function(t,o){this.getView().getModel("empleado");var n=this;this.aSelectedContexts=o;var a=this.getView().getModel("empleado");a.setProperty("/ID",o.map(function(e){return e.getObject().ID}));a.setProperty("/primerNombre",o.map(function(e){return e.getObject().primerNombre}));a.setProperty("/apellidoPaterno",o.map(function(e){return e.getObject().apellidoPaterno}));a.setProperty("/apellidoMaterno",o.map(function(e){return e.getObject().apellidoMaterno}));var i=1;var s=function(){this.base.editFlow.invokeAction("PensionesService.maxPorcentajeCheck",{contexts:this.aSelectedContexts,skipParameterDialog:true}).then(function(e){n.base.getExtensionAPI().refresh()})}.bind(this);s();a.setProperty("/maxAportacion",i);if(!this.pDialog){this.pDialog=e.load({id:"idupdatePorcentaje",name:"mis.pensiones.ext.fragment.UpdatePorcentaje",controller:this})}this.pDialog.then(function(e){e.open()})},onCargaManual:function(t){var o=this;if(!this.pDialog){this.pDialog=e.load({id:"idUploadFile",name:"mis.pensiones.ext.fragment.UploadFile",controller:this})}this.pDialog.then(function(e){e.open()})},onBeforeOpen:function(e){this.oUploadDialog=e.getSource();this.base.getExtensionAPI().addDependent(this.oUploadDialog)},onAfterClose:function(e){this.base.getExtensionAPI().removeDependent(this.oUploadDialog);this.oUploadDialog.destroy();this.oUploadDialog=null;this.pDialog=undefined},setDialogBusy:function(e){this.oUploadDialog&&this.oUploadDialog.setBusy(e);this.oPorcentajeDialog&&this.oPorcentajeDialog.setBusy(e)},byId:function(t,o){return e.byId(t,o)},onCancel:function(e){this.closeDialog()},onCancelPorcentaje:function(e){this.closeDialog()},closeDialog:function(){this.oUploadDialog&&this.oUploadDialog.close();this.oPorcentajeDialog&&this.oPorcentajeDialog.close()},validateInput:function(e){var t=e.getBinding("aportacion")},setOkButtonEnabled:function(e){this.oUploadDialog&&this.oUploadDialog.getBeginButton().setEnabled(e);this.oPorcentajeDialog&&this.oPorcentajeDialog.getBeginButton().setEnabled(e)},onOk:function(e){this.setDialogBusy(true);var t=this.byId("idUploadFile","uploader");var o=new sap.ui.unified.FileUploaderParameter;o.setName("slug");o.setValue("Empleado");t.removeHeaderParameter("slug");t.addHeaderParameter(o);let n;if(window.location.href.search("port4004")>0)n=this.base.getExtensionAPI()._controller._oAppComponent.getManifestObject().resolveUri("/pensiones/cargaDeExcel/excel");else{n="pensiones/cargaDeExcel/excel"}t.setUploadUrl(n);t.checkFileReadable().then(function(){t.upload()}).catch(function(e){const t=this._resourceBundle.getText("fileNotReadable");this.showError(t);this.setDialogBusy(false)})},showError:function(e,t,o){const n=this._resourceBundle.getText("uploadFailed");p.error(n)},onTypeMismatch:function(e){var t=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");let o=this._resourceBundle.getText("fileTypeNotSupported");const n=this._resourceBundle.getText("supportedTypes");o=o+" *. "+e.getParameter("fileType")+". "+n+t;this.showError(o)},onFileAllowed:function(e){this.setOkButtonEnabled(true)},onFileEmpty:function(e){this.setOkButtonEnabled(false)},onUploadComplete:function(e){var t=e.getParameter("status");var o=e.getSource();o.clear();this.setOkButtonEnabled(false);this.setDialogBusy(false);if(t>=400){var n;try{n=JSON.parse(e.getParameter("responseRaw"))}catch(t){n=e.getParameter("responseRaw")}if(n&&n.error&&n.error.message){this.showError(n.error.code,n.error.target,n&&n.error&&n.error.message);this.closeDialog()}else{this.closeDialog()}}else{let t=JSON.parse(e.mParameters.responseRaw);if(t.length){this._downloadSpreadsheet(t,"Registros")}this.closeDialog()}},_createColumnConfig:function(e){return e.map(function(e){let t={};t.label=e.toUpperCase();t.property=e;return t})},onOkPorcentaje:function(e){this.setDialogBusy(true);var t=this;let o=this.byId("idupdatePorcentaje","idAportacion").getValue();var n=function(){this.base.editFlow.invokeAction("PensionesService.cambioPorcentaje",{contexts:this.aSelectedContexts,parameterValues:[{name:"aportacionFutura",value:o}],skipParameterDialog:true}).then(function(e){t.setDialogBusy(false);t.closeDialog();t.base.getExtensionAPI().refresh()})}.bind(this);n()},onBeforeOpenPorcentaje:function(e){this.oPorcentajeDialog=e.getSource();this.base.getExtensionAPI().addDependent(this.oPorcentajeDialog)},onAfterClosePorcentaje:function(e){this.base.getExtensionAPI().removeDependent(this.oPorcentajeDialog);this.oPorcentajeDialog.destroy();this.oPorcentajeDialog=null;this.pDialog=undefined},onPorcentajeChange:function(e){this.setOkButtonEnabled(true)}})});